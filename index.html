<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <!-- author Leo Baschy 2021 initially -->
  <title>Inflation — US — Annual</title>
  <style>
    .container {
      display: grid;
      grid-template-columns: min-content 3fr min-content 3fr;
      grid-template-rows: auto auto auto auto auto;
      gap: 1rem;
      width: min-content;
    }

    .heading {
      grid-column: 1 / 5;
      font-family: sans-serif;
      font-size: larger;
    }

    .container * {
      align-self: baseline;
    }

    input[type='number'] {
      max-width: 10em;
    }
  </style>
</head>

<body>
  <div id="calculator">
    <div class="container">
      <div class="heading">Inflation — US</div>
      <div>
        From:
      </div>
      <div>
        <select name="fromYear">
        </select>
      </div>
      <div>
        $
      </div>
      <div>
        <input name="fromAmount" type="number" min="0" />
      </div>
      <div class="col-md-2">
        To:
      </div>
      <div>
        <select name="toYear">
        </select>
      </div>
      <div>
        $
      </div>
      <div>
        <input name="toAmount" type="number" min="0" />
      </div>
    </div>
  </div>
  <script>
    // data from https://www.bls.gov/data/inflation_calculator.htm
    const cpi = {
      "1913": 100,
      "1914": 102,
      "1915": 103,
      "1916": 106,
      "1917": 119,
      "1918": 143,
      "1919": 168,
      "1920": 200,
      "1921": 194,
      "1922": 172,
      "1923": 171,
      "1924": 177,
      "1925": 177,
      "1926": 183,
      "1927": 179,
      "1928": 177,
      "1929": 174,
      "1930": 174,
      "1931": 162,
      "1932": 146,
      "1933": 132,
      "1934": 135,
      "1935": 139,
      "1936": 141,
      "1937": 144,
      "1938": 145,
      "1939": 143,
      "1940": 142,
      "1941": 144,
      "1942": 160,
      "1943": 172,
      "1944": 178,
      "1945": 182,
      "1946": 186,
      "1947": 219,
      "1948": 242,
      "1949": 245,
      "1950": 240,
      "1951": 259,
      "1952": 270,
      "1953": 271,
      "1954": 274,
      "1955": 272,
      "1956": 273,
      "1957": 282,
      "1958": 292,
      "1959": 296,
      "1960": 299,
      "1961": 304,
      "1962": 306,
      "1963": 310,
      "1964": 315,
      "1965": 318,
      "1966": 324,
      "1967": 336,
      "1968": 348,
      "1969": 363,
      "1970": 386,
      "1971": 406,
      "1972": 419,
      "1973": 435,
      "1974": 476,
      "1975": 532,
      "1976": 567,
      "1977": 597,
      "1978": 638,
      "1979": 697,
      "1980": 794,
      "1981": 888,
      "1982": 962,
      "1983": 998,
      "1984": 1040,
      "1985": 1077,
      "1986": 1118,
      "1987": 1135,
      "1988": 1181,
      "1989": 1236,
      "1990": 1300,
      "1991": 1373,
      "1992": 1409,
      "1993": 1455,
      "1994": 1492,
      "1995": 1534,
      "1996": 1576,
      "1997": 1624,
      "1998": 1650,
      "1999": 1677,
      "2000": 1722,
      "2001": 1787,
      "2002": 1807,
      "2003": 1854,
      "2004": 1890,
      "2005": 1946,
      "2006": 2023,
      "2007": 2065,
      "2008": 2154,
      "2009": 2155,
      "2010": 2211,
      "2011": 2247,
      "2012": 2313,
      "2013": 2350,
      "2014": 2387,
      "2015": 2385,
      "2016": 2418,
      "2017": 2478,
      "2018": 2529,
      "2019": 2568,
      "2020": 2632,
      "2021": 2669
    };
    const years = Object.keys(cpi).sort();
    const mostRecentYear = years[years.length - 1];
    //
    const fromYearElement = document.querySelector("[name='fromYear']");
    const toYearElement = document.querySelector("[name='toYear']");
    const fromAmountElement = document.querySelector("[name='fromAmount']");
    const toAmountElement = document.querySelector("[name='toAmount']");
    //
    for (const year of years) {
      const optionElement = document.createElement("option");
      optionElement.value = year;
      optionElement.textContent = mostRecentYear - year < 100 ? year.substring(2) : year;
      fromYearElement.append(optionElement);
      toYearElement.append(optionElement.cloneNode(true));
    }
    //
    let fromYear = localStorage.getItem("fromYear");
    if (!cpi[fromYear]) fromYear = mostRecentYear; // if not known
    fromYearElement.querySelector(`option[value='${fromYear}']`).selected = true;
    //
    let toYear = localStorage.getItem("toYear") || years[years.length - 1];
    if (!cpi[toYear]) toYear = mostRecentYear; // if not known
    toYearElement.querySelector(`option[value='${toYear}']`).selected = true;
    //
    let fromAmount = Number(localStorage.getItem("fromAmount")) || 0;
    let toAmount = Number(localStorage.getItem("toAmount")) || 0;
    let moreRecentlyHasEnteredToAmount = localStorage.getItem("moreRecentlyHasEnteredToAmount") || false;
    //
    function showAmounts() {
      if (Math.abs(fromAmount) < 10) fromAmount = Math.round(fromAmount * 100) / 100;
      else if (fromAmount < 100) fromAmount = Math.round(fromAmount * 10) / 10;
      else fromAmount = Math.round(fromAmount);
      if (Math.abs(toAmount) < 10) toAmount = Math.round(toAmount * 100) / 100;
      else if (toAmount < 100) toAmount = Math.round(toAmount * 10) / 10;
      else toAmount = Math.round(toAmount);
      fromAmountElement.value = fromAmount;
      toAmountElement.value = toAmount;
      localStorage.setItem("fromAmount", fromAmount);
      localStorage.setItem("toAmount", toAmount);
      localStorage.setItem("moreRecentlyHasEnteredToAmount", moreRecentlyHasEnteredToAmount);
    }
    function fromTo() {
      toAmount = fromAmount * cpi[toYear] / cpi[fromYear];
      showAmounts();
    }
    function toFrom() {
      fromAmount = toAmount * cpi[fromYear] / cpi[toYear];
      showAmounts();
    }
    fromTo();
    //
    fromYearElement.addEventListener("input", event => {
      fromYear = fromYearElement.selectedOptions[0].value;
      localStorage.setItem("fromYear", fromYear);
      if (!moreRecentlyHasEnteredToAmount) {
        fromTo();
      } else {
        toFrom();
      }
    });
    toYearElement.addEventListener("input", event => {
      toYear = toYearElement.selectedOptions[0].value;
      localStorage.setItem("toYear", toYear);
      fromTo();
    });
    //
    fromAmountElement.addEventListener("input", event => {
      fromAmount = Number(fromAmountElement.value);
      moreRecentlyHasEnteredToAmount = false;
      fromTo();
    });
    toAmountElement.addEventListener("input", event => {
      toAmount = Number(toAmountElement.value);
      moreRecentlyHasEnteredToAmount = true;
      toFrom();
    });
    //
    fromAmountElement.addEventListener("click", event => {
      moreRecentlyHasEnteredToAmount = false;
    });
    toAmountElement.addEventListener("click", event => {
      moreRecentlyHasEnteredToAmount = true;
    });
  </script>
</body>

</html>